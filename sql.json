{
   "Create Date Dimension snippet":{
      "prefix":"sqlCreateDateDimenstion",
      "body":[
         "--DATE TABLE--",
         "if OBJECT_ID('[dbo].[DimDate]', 'U') is not null",
         "drop table [dbo].[DimDate]",
         "go",
         "create table [dbo].[DimDate]",
         "(",
         "    [dateKey] int not null",
         "    ,[dateUnix] int not null",
         "    ,[date] date not null",
         "    ,[year] int not null",
         "    ,[quarter] int not null",
         "    ,[month] int not null",
         "    ,[day] int not null",
         "    ,[weekDay] int not null",
         "    ,[weekIso] int not null",
         "    ,[startOfYear] date not null",
         "    ,[endOfYear] date not null",
         "    ,[startOfQuarter] date not null",
         "    ,[endOfQuarter] date not null",
         "    ,[startOfMonth] date not null",
         "    ,[endOfMonth] date not null",
         "    ,[startOfWeekIso] date not null",
         "    ,[endOfWeekIso] date not null",
         "    ,constraint",
         "    PK_date_key primary key clustered (dateKey asc)",
         ");",
         "go",
         "",
         "--DATE PROCEDURE--",
         "--GENERATE DATES FROM @RangeStart TO @RangeEnd AND MERGE IT WITH DimDate",
         "if exists (",
         "select *",
         "from INFORMATION_SCHEMA.ROUTINES",
         "where SPECIFIC_SCHEMA = N'dbo'",
         "    and SPECIFIC_NAME = N'MergeDimDate'",
         "    and ROUTINE_TYPE = N'PROCEDURE'",
         ")",
         "drop procedure dbo.MergeDimDate",
         "go",
         "",
         "create procedure dbo.MergeDimDate",
         "    @RangeStart date",
         "    ,@RangeEnd date",
         "as",
         "",
         "SET DATEFIRST 1;",
         "",
         "with",
         "DateDimension as (",
         "        select @RangeStart as DateValue",
         "    union all",
         "        select dateadd(d,1,DateValue)",
         "        from DateDimension",
         "        where dateadd(d,1,DateValue) <= @RangeEnd",
         "),",
         "",
         "DateList as (",
         "select",
         "    convert(varchar, DateValue, 112) as [dateKey]",
         "    ,datediff(s,'1970-01-01',DateValue) as [dateUnix]",
         "    ,DateValue as [date]",
         "    ,datepart(yyyy, DateValue) as [year]",
         "    ,datepart(q, DateValue) as [quarter]",
         "    ,datepart(mm, DateValue) as [month]",
         "    ,datepart(dd, DateValue) as [day]",
         "    ,datepart(dw, DateValue) as [weekDay]",
         "    ,datepart(iso_week, DateValue) as [weekIso]",
         "    ,cast(dateadd(yy, datediff(yy, 0, DateValue), 0) as date) as [startOfYear]",
         "    ,cast(dateadd(yy, datediff(yy, 0, DateValue)+1, -1) as date) as [endOfYear]",
         "    ,cast(dateadd(qq, datediff(qq, 0, DateValue), 0) as date) as [startOfQuarter]",
         "    ,cast(dateadd (dd, -1, dateadd(qq, datediff(qq, 0, DateValue) +1, 0)) as date) as [endOfQuarter]",
         "    ,dateadd(d,1,eomonth(DateValue,-1)) as [startOfMonth]",
         "    ,eomonth(DateValue,0) as [endOfMonth]",
         "    ,dateadd(d,1 - datepart(dw, DateValue), DateValue) as [startOfWeekIso]",
         "    ,dateadd(d,7 - datepart(dw, DateValue), DateValue) as [endOfWeekIso]",
         "",
         "from DateDimension",
         ")",
         "",
         "merge dbo.DimDate as tgt",
         "using DateList as src",
         "    on tgt.dateKey = src.dateKey",
         "when not matched then insert",
         "values(",
         "    src.[dateKey]",
         "    ,src.[dateUnix]",
         "    ,src.[date]",
         "    ,src.[year]",
         "    ,src.[quarter]",
         "    ,src.[month]",
         "    ,src.[day]",
         "    ,src.[weekDay]",
         "    ,src.[weekIso]",
         "    ,src.[startOfYear]",
         "    ,src.[endOfYear]",
         "    ,src.[startOfQuarter]",
         "    ,src.[endOfQuarter]",
         "    ,src.[startOfMonth]",
         "    ,src.[endOfMonth]",
         "    ,src.[startOfWeekIso]",
         "    ,src.[endOfWeekIso]",
         ")",
         "--OUTPUT $action, inserted.*--,deleted.*",
         "option",
         "(maxrecursion 0)",
         ";",
         "go"
      ],
      "description":"Create Date Dimension Table and Procedure snippet"
   }
}